<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="referrer" content="no-referrer-when-downgrade" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="current-user-id" content="{{ current_user.id if current_user.is_authenticated else '' }}">
  <meta name="76c46547d0595250235852b887804a1f11a47bf4" content="76c46547d0595250235852b887804a1f11a47bf4" />
  <title>
      {% block title %}
          {% if store is defined and store.name is defined %}
              {{ store.name }}
          {% else %}
              SmartEats
          {% endif %}
      {% endblock %}
  </title>
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-MV473VBW');</script>
  <!-- End Google Tag Manager -->
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='worka.png') }}">
  <link href="{{ url_for('static', filename='css/fontawesome-free/css/all.min.css') }}" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='lib/bootstrap/dist/css/bootstrap.min.css') }}"/>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/site.css') }}"/>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/_Layout.css') }}"/>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/adminstyles.css') }}"/>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/orders.css') }}"/>
  <link rel="stylesheet" href="{{ url_for('static', filename='lib/pace/themes/blue/pace-theme-minimal.css') }}">

  <script src="{{ url_for('static', filename='lib/pace/pace.min.js') }}"></script>
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>

  <style>
    body {
        background: linear-gradient(135deg, #FFF9F0, #FFFAF5);
        font-family: 'Nunito', sans-serif;
    }

    .logo { max-height: 80px; width: auto; }
    @media (max-width: 768px) { .logo { max-height: 60px; } }

    header { margin:20px auto; padding:10px 20px; backdrop-filter: blur(8px); background-color: rgba(255,255,255,0.95); border-radius: 10px; }

    .navbar-nav .nav-item .btn { margin: 2px; display:flex; align-items:center; gap:5px; }

    /* Icon + hover text */
    .icon-btn .link-text {
        display: none;
        font-size: 0.9rem;
    }

    .icon-btn:hover .link-text { display: inline; }

    /* Cart count always visible */
    #cart-count {
        font-size: 0.8rem;
        margin-left: 3px;
        color: #dc3545;
        font-weight: bold;
    }

    /* Responsive: stack text under icon for small screens */
    @media (max-width: 576px) {
        .navbar-nav .nav-item .btn {
            flex-direction: column;
            padding:5px 10px;
        }
        .icon-btn .link-text { display: block; font-size: 0.8rem; }
    }

    .pace { pointer-events: none; user-select: none; }
    .pace.pace-active { background: rgba(255, 255, 255, 0.8); position: fixed; z-index: 9999; top: 0; left: 0; width: 100%; height: 100%; }
    .pace .pace-progress { background: #00b37e; position: fixed; z-index: 2000; top: 0; right: 100%; width: 100%; height: 3px; }
    .pace .pace-activity { display: block; position: fixed; z-index: 2001; top: 50%; left: 50%; width: 45px; height: 45px; border: 4px solid #00b37e; border-top-color: transparent; border-radius: 50%; animation: pace-spinner 0.8s linear infinite; transform: translate(-50%, -50%); }
    @keyframes pace-spinner { 0% { transform: translate(-50%, -50%) rotate(0deg); } 100% { transform: translate(-50%, -50%) rotate(360deg); } }
  </style>
</head>
<body>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MV473VBW"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<!-- Audio -->
<audio id="new_order" preload="auto" src="{{ url_for('static', filename='sounds/new_order.wav') }}"></audio>
<audio id="order_update" preload="auto" src="{{ url_for('static', filename='sounds/order_update.wav') }}"></audio>
<audio id="order_ready" preload="auto" src="{{ url_for('static', filename='sounds/order_ready.wav') }}"></audio>

<script>
  if (!window._socket) {
    window._socket = io({ transports:["polling"], upgrade:false, reconnection:true, reconnectionAttempts:5 });
  }
  const socket = window._socket;
  let audioUnlocked = false;
  document.body.addEventListener("click", () => { audioUnlocked = true; }, { once:true });

  socket.on("play_sound", function (data) {
    if (!audioUnlocked) return;
    const audio = document.getElementById(data.sound);
    if (audio) { audio.currentTime=0; audio.play().catch(()=>{}); }
  });

  socket.on("cart_updated", function(data){
    const el = document.getElementById("cart-count");
    if(el) el.textContent = data.cart_count;
  });
</script>
<script>
(function(onj){
var d = document,
    s = d.createElement('script'),
    l = d.scripts[d.scripts.length - 1];
s.settings = onj || {};
s.src = "\/\/shockedmirror.com\/blXlV.s\/dDGUl-0ZYZWpco\/DeLm-9HueZ-UYlekVPVTYYy3ENVDhMa2eM\/zlA\/tQNTjWcK0JMizlY\/zhM\/QG";
s.async = true;
s.referrerPolicy = 'no-referrer-when-downgrade';
l.parentNode.insertBefore(s, l);
})({})
</script>

<header>
  <nav class="navbar navbar-expand-sm navbar-light border-bottom box-shadow mb-3">
    <div class="container">
      <img src="{{ url_for('static', filename='css/images/worka.png') }}" class="img-fluid logo" />
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target=".navbar-collapse">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="navbar-collapse collapse flex-sm-row justify-content-between">
        <ul class="navbar-nav flex-row flex-wrap gap-1">
          {% if current_user.is_authenticated %}
          <li class="nav-item icon-btn">
            <a href="{{ url_for('main.home') }}" class="btn bg-light rounded-pill">
              <i class="fas fa-home"></i> <span class="link-text">Home</span>
            </a>
          </li>
          <li class="nav-item icon-btn">
            <a href="{{ url_for('main.menu', page_num=1) }}" class="btn bg-light rounded-pill">
              <i class="fas fa-utensils"></i> <span class="link-text">Menu</span>
            </a>
          </li>
          <li class="nav-item icon-btn">
            <a href="{{ url_for('main.restuarants') }}" class="btn bg-light rounded-pill">
              <i class="fas fa-store"></i> <span class="link-text">Stores</span>
            </a>
          </li>
          <li class="nav-item icon-btn">
            <a href="{{ url_for('main.cart') }}" class="btn bg-light rounded-pill">
              <i class="fas fa-shopping-cart"></i> <span class="link-text">Cart</span>
              <sup id="cart-count">{{ total_count or 0 }}</sup>
            </a>
          </li>
          <li class="nav-item icon-btn">
            <a href="{{ url_for('main.myorders') }}" class="btn bg-light rounded-pill">
              <i class="fas fa-box"></i> <span class="link-text">Orders</span>
            </a>
          </li>
          <li class="nav-item icon-btn">
            <a href="{{ url_for('main.account') }}" class="btn bg-light rounded-pill">
              <i class="fas fa-user"></i> <span class="link-text">Profile</span>
            </a>
          </li>
          <li class="nav-item icon-btn">
            <a href="{{ url_for('main.logout') }}" class="btn bg-light rounded-pill">
              <i class="fas fa-sign-out-alt"></i> <span class="link-text">Logout</span>
            </a>
          </li>
          {% else %}
          <li class="nav-item icon-btn">
            <a href="{{ url_for('auth.newlogin') }}" class="btn bg-light rounded-pill">
              <i class="fas fa-sign-in-alt"></i> <span class="link-text">Login</span>
            </a>
          </li>
          <li class="nav-item icon-btn">
            <a href="{{ url_for('auth.register') }}" class="btn bg-light rounded-pill">
              <i class="fas fa-user-plus"></i> <span class="link-text">Register</span>
            </a>
          </li>
          <li class="nav-item icon-btn">
            <a href="{{ url_for('auth.registerstore') }}" class="btn bg-light rounded-pill">
              <i class="fas fa-store-alt"></i> <span class="link-text">Register Store</span>
            </a>
          </li>
          <li class="nav-item icon-btn">
            <a href="{{ url_for('main.restuarants') }}" class="btn bg-light rounded-pill">
              <i class="fas fa-store"></i> <span class="link-text">Stores</span>
            </a>
          </li>
          {% endif %}
        </ul>
      </div>
    </div>
  </nav>
</header>

<div class="container">
  <main role="main" class="pb-3">
    {% with messages = get_flashed_messages() %}
        {% if messages %}
        <div class="mt-3">
            {% for message in messages %}
                <div class="alert alert-info" role="alert">{{ message }}</div>
            {% endfor %}
        </div>
        {% endif %}
    {% endwith %}
    {% block content %}{% endblock %}
  </main>
</div>

<footer class="border-top footer text-muted" style="background: #fff4e6; padding:15px;">
  <div class="container text-center">&copy; 2025 - SmartEats by Pi Technologies</div>
</footer>

<script src="{{ url_for('static', filename='lib/jquery/dist/jquery.min.js') }}"></script>
<script src="{{ url_for('static', filename='lib/bootstrap/dist/js/bootstrap.bundle.min.js') }}"></script>
<script>
(function(mumulj){
var d = document,
    s = d.createElement('script'),
    l = d.scripts[d.scripts.length - 1];
s.settings = mumulj || {};
s.src = "\/\/shockedmirror.com\/bYXOVjs.duGcl\/0lYNWDcE\/LeJmm9gu-ZuUCl-kIPXTbYf3vNSD\/M\/2gMoDqkwtKN_jGcr0IM\/zgYYxlMZAk";
s.async = true;
s.referrerPolicy = 'no-referrer-when-downgrade';
l.parentNode.insertBefore(s, l);

})({})
</script>
<script>
(function(opzqcv){
var d = document,
    s = d.createElement('script'),
    l = d.scripts[d.scripts.length - 1];
s.settings = opzqcv || {};
s.src = "\/\/shockedmirror.com\/bnX.VysQd\/G\/lk0lYtW\/cb\/_epmX9wudZlUAlWkgPbTwY\/3JNADDMf2sMwTqIztoNXj\/cv0lM_zkYKxaMtwv";
s.async = true;
s.referrerPolicy = 'no-referrer-when-downgrade';
l.parentNode.insertBefore(s, l);
})({})
</script>
</body>
</html>
