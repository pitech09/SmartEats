{% extends "layout.html" %}
{% block title %}My Orders - SmartEats{% endblock %}
{% block content %}

<style>
.order-list { margin-bottom: 25px; display: flex; gap: 10px; flex-wrap: wrap; }
.order-list .btn { border-radius: 50px; padding: 0.55rem 1.4rem; font-weight: 500; background-color: #e7f0ff; border: 1px solid #bcd4ff; color: #0a5bd3; transition: all 0.28s ease; }
.order-list .btn:hover { background-color: #d4f7df; border-color: #8ce3a4; color: #166e2e; transform: translateY(-3px); box-shadow: 0 6px 14px rgba(0,0,0,0.08); cursor: pointer; }
.order-card { background: #fff; border-radius: 14px; padding: 18px 22px; margin-bottom: 18px; border: 1px solid #eef1f5; box-shadow: 0 4px 12px rgba(0,0,0,0.04); transition: all 0.3s ease; }
.order-card:hover { transform: translateY(-4px); box-shadow: 0 8px 18px rgba(0,0,0,0.08); }
.order-card h3 { margin-bottom: 10px; color: #222; font-weight: 600; }
.order-card p { margin: 4px 0; color: #555; font-size: 0.95rem; }
.empty-message { padding: 20px; font-size: 1.1rem; color: #444; border-radius: 12px; background: #f8f9fb; text-align: center; border: 1px solid #e2e6eb; }
ul { padding-left: 18px; margin: 6px 0; }
ul li { margin-bottom: 4px; font-size: 0.92rem; color: #333; }
</style>

<div class="order-list">
    <button class="btn" onclick="window.location.href='{{ url_for('main.myorders')}}'">Active/Pending Orders</button>
    <button class="btn" onclick="window.location.href='{{ url_for('main.completed_order') }}'">Order History</button>
    <button class="btn" onclick="window.location.href='{{ url_for('main.cancelled_orders')}}'">Cancelled Orders</button>
</div>

<section class="order-list" id="active-orders">
    {% if not order %}
        <div class="empty-message">
            You have no active orders just yet. Navigate to menu and add your order.
        </div>
    {% else %}
        {% for o in order %}
        <div class="order-card">
            <h3>Order ID: {{ o.order_id }}</h3>
            <p>Status: {{ o.status }}</p>
            <p>Source: {{ o.store.name if o.store else 'N/A' }}</p>
            <p>Destination: {{ o.location }}</p>
            <p>Delivery By: {{ o.deliveryguy or 'N/A' }}</p>
            <p>Order Date: {{ o.create_at.strftime('%Y-%m-%d @ %H:%M') }}</p>
            <hr>
            <h5>Items:</h5>
            <ul>
                <!-- Regular products -->
                {% for item in o.order_items %}
                <li>{{ item.product_name }} x {{ item.quantity }} (M{{ '%.2f'|format(item.product_price) }})</li>
                {% endfor %}

                <!-- Custom meals -->
                {% for cm in o.custom_meals %}
                <li>
                    {{ cm.name }} x 1 (M{{ '%.2f'|format(cm.total_price) }})
                    {% if cm.ingredients %}
                    <ul>
                        {% for ing in cm.ingredients %}
                        <li>{{ ing.ingredient_name }} x {{ ing.quantity }} (M{{ '%.2f'|format(ing.ingredient_price) }})</li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endfor %}
    {% endif %}
</section>

{% endblock %}
